<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Tournoi - boulle!{% endblock %}</title>
        <meta charset="utf-8" />
	    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
	    <link rel="icon" type="image/png" href="../assets/img/favicon.ico">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
	    <link rel="stylesheet" href="{{ asset('assets/toastr/toastr.min.css') }}"/>
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" />
	    <link href="{{asset('assets/css/bootstrap.min.css')}}" rel="stylesheet" />
	    <link href="{{asset('assets/css/base.css')}}" rel="stylesheet" />
	    <style type="text/css">
	    </style>
	    {% block stylesheets %}{% endblock %}
    </head>
    <body data-base-url="{{url('base_url')}}" 
    	  data-tournoi-id="{% block id_tournoi %}{% endblock %}"
    	  data-tournoi-etat="{% block tournoi_etat %}{% endblock %}"
    	  data-date-end="{% block date_end %}{% endblock %}"
    	  data-date-debut="{% block date_debut %}{% endblock %}"
    	 >

    	{% block body %}{% endblock %}

    </body>    

    <script src="{{asset('assets/js/core/jquery.3.2.1.min.js')}}" type="text/javascript"></script>
    <script src="{{ asset('assets/toastr/toastr.min.js') }}"></script>
    <script type="text/javascript">

    	$idTournoi = $('body').data('tournoi-id');
    	$etatTournoi = $('body').data('tournoi-etat');
    	$dateEnd = $('body').data('date-end');
    	$dateDebut = $('body').data('date-debut');
    	$isEnd = false; // test de fin du mactch dans l'evolution du chrono

		var start = 0
		var end = 0
		var diff = 0
		var timerID = 0
        var storageDate = {};
		
		{#/*localStorage.removeItem("tournoi_"+$idTournoi);*/#}
		
		$(window).bind("load", function() {
		   	if($etatTournoi == "en_cours"){
		   		chronoStart();
		   		intervalId = setInterval(chrono, 1000);
		   	}
		});
        function initCrono(){
            if(localStorage.getItem("tournoi_"+$idTournoi)){
                storageDate = JSON.parse(localStorage.getItem("tournoi_"+$idTournoi));
                start = new Date(storageDate.date_debut);
                end = new Date();
            }
            else{
                var dataInfo = {tournoi:"tournoi_"+$idTournoi, date_debut: $dateDebut, date_fin: $dateEnd};
                localStorage.setItem("tournoi_"+$idTournoi, JSON.stringify(dataInfo)); 
                start = $dateDebut;
            }
        }
		function chrono(){
			end = new Date()
			diff = end - start
			diff = new Date(diff)
			var msec = diff.getMilliseconds()
			var sec = diff.getSeconds()
			var min = diff.getMinutes()
			var hr = diff.getHours()-1
			if (hr < 10){
				hr = "0" + hr
			}
			if (min < 10){
				min = "0" + min
			}
			if (sec < 10){
				sec = "0" + sec
			}
			if(msec < 10){
				msec = "00" +msec
			}
			else if(msec < 100){
				msec = "0" +msec
			}
			document.getElementById("chronotime").innerHTML  = hr + ":" + min + ":" + sec/* + ":" + msec*/
			if( (new Date() >= new Date(storageDate.date_fin)) && !$isEnd ){
				//localStorage.removeItem("tournoi_"+$idTournoi);
				//clearInterval(intervalId);
				$isEnd = true;
				toastr.warning("Ce tournoi devrait etre termin√© maintenant");
				//window.location.reload(true);
			}
		}
		function chronoStart(){
			initCrono();
			document.chronoForm.startstop.value = "stop!"
			document.chronoForm.startstop.onclick = chronoStop
			document.chronoForm.reset.onclick = chronoReset
			chrono()
		}
		function chronoContinue(){
			document.chronoForm.startstop.value = "stop!"
			document.chronoForm.startstop.onclick = chronoStop
			document.chronoForm.reset.onclick = chronoReset
			start = new Date()-diff
			start = new Date(start)
			chrono()
		}
		function chronoReset(){
			document.getElementById("chronotime").innerHTML  = "0:00:00:000"
			start = new Date()
		}
		function chronoStopReset(){
			document.getElementById("chronotime").innerHTML  = "0:00:00:000"
			document.chronoForm.startstop.onclick = chronoStart
		}
		function chronoStop(){
			document.chronoForm.startstop.value = "start!"
			document.chronoForm.startstop.onclick = chronoContinue
			document.chronoForm.reset.onclick = chronoStopReset
			clearInterval(intervalId);
		}
    </script>
    {% block javascripts %}{% endblock %}
</html>
